# ğŸ¨ å›¾åƒé¢œè‰²åˆ†ç±»ä¸å‘½åæŠ€æœ¯æ–¹æ¡ˆï¼ˆv2.0ï¼‰

### --- åŸºäºä¸»è‰²ç‰¹å¾ã€æ„ŸçŸ¥ç©ºé—´èšç±»ä¸è¯­ä¹‰å‘½åçš„è‡ªé€‚åº”ä½“ç³» ---

## 1. æ–¹æ¡ˆç›®æ ‡

æ„å»ºä¸€ä¸ªèƒ½è‡ªåŠ¨ä»å›¾ç‰‡ä¸­è¯†åˆ«å¹¶å‘½åä¸»è¦è‰²å½©é£æ ¼çš„ç³»ç»Ÿã€‚ç³»ç»Ÿå…¼é¡¾**ç®—æ³•ç¨³å®šæ€§**ä¸**äººçœ¼æ„ŸçŸ¥ä¸€è‡´æ€§**ï¼Œå®ç°ä»¥ä¸‹ç›®æ ‡ï¼š -
è‡ªåŠ¨æå–å›¾åƒä¸»è‰²ï¼ˆTop-N Dominant Colorsï¼‰ï¼› - åŸºäº LAB
ç©ºé—´èšç±»å‡ºå…¨å±€è‰²ç³»ï¼› - è‡ªåŠ¨ç”Ÿæˆ**å¯è¯»é¢œè‰²åç§°**ï¼ˆåŸºäº CSS/xkcd
è‰²åº“ï¼‰ï¼› - è‡ªé€‚åº”è°ƒæ•´èšç±»æ•°é‡ä¸ç°‡ç»“æ„ã€‚

## 2. æ•´ä½“æµç¨‹

    å›¾ç‰‡è¾“å…¥
       â†“
    ä¸»è‰²æå–ï¼ˆMedian-Cutï¼‰
       â†“
    ä¸»è‰² RGB â†’ LAB
       â†“
    é¢œè‰²å‘½åï¼ˆColorNameResolver + CSS/xkcd paletteï¼‰
       â†“
    å…¨å±€èšç±»ï¼ˆKMeansï¼ŒLAB ç©ºé—´ï¼‰
       â†“
    ä¸»ç°‡ / ä¸»è°ƒåˆ¤å®š
       â†“
    è¾“å‡ºï¼šä»£è¡¨è‰² + è‰²å + ç°‡ç»“æ„
       â†“
    å‘¨æœŸæ€§è‡ªé€‚åº”æ›´æ–°

## 3. ä¸»è‰²æå–ï¼ˆå•å›¾å±‚ï¼‰

### 3.1 ç®—æ³•é€‰æ‹©

-   **ç®—æ³•**ï¼šMedian-Cut æˆ–ç®€åŒ–ç‰ˆ KMeansï¼ˆk=5ï¼‰ï¼›
-   **ç›®æ ‡**ï¼šæå–è§†è§‰ä¸»å¯¼è‰²ï¼›
-   **è¾“å‡º**ï¼šæ¯å¼ å›¾ç‰‡çš„ 5 ä¸ªä¸»è‰²åŠæƒé‡ï¼ˆå æ¯”ï¼‰ã€‚

### 3.2 è¯´æ˜

Median-Cut å¯¹é¢œè‰²ç©ºé—´é€’å½’åˆ†å‰²ï¼Œæ¯ä¸ªåˆ†å—ä»£è¡¨ä¸€ç»„è¿‘ä¼¼é¢œè‰²ï¼š -
ç»“æœç¨³å®šä¸”é€Ÿåº¦å¿«ï¼› - å–å‡ºçš„é¢œè‰²çœŸå®å­˜åœ¨äºå›¾åƒä¸­ï¼› - æ¯” KMeans
æ›´è´´è¿‘è§†è§‰ä¸»è‰²ã€‚

### 3.3 è¾“å‡ºç»“æ„

``` python
image_id, [ (R_i, G_i, B_i, w_i) for i in 1..5 ]
```

## 4. é¢œè‰²ç©ºé—´ä¸è½¬æ¢

-   **æå–é˜¶æ®µ**ï¼šåœ¨ **RGB** ç©ºé—´æ“ä½œï¼ˆåŸºäºåƒç´ ï¼‰ï¼›\
-   **èšç±»ä¸è·ç¦»è®¡ç®—**ï¼šç»Ÿä¸€è½¬ä¸º **CIE LAB** ç©ºé—´ï¼›
-   **è·ç¦»åº¦é‡**ï¼šä½¿ç”¨ Î”Eâ‚€â‚€ è‰²å·®ï¼›
-   **å‘½åæ˜ å°„**ï¼šåŒæ ·åŸºäº LAB ç©ºé—´è¿›è¡Œæœ€è¿‘é‚»åŒ¹é…ã€‚

**ç†ç”±**ï¼šRGB é€‚åˆå–æ ·ï¼ŒLAB é€‚åˆæ„ŸçŸ¥æ¯”è¾ƒã€‚

## 5. é¢œè‰²å‘½åæ¨¡å—ï¼ˆColorNameResolverï¼‰

### 5.1 æ¨¡å—èŒè´£

å°†æ¯ä¸ªä¸»è‰²çš„ LAB å€¼æ˜ å°„åˆ°**æœ€è¿‘çš„æ ‡å‡†è‰²å**ã€‚

### 5.2 æ•°æ®æ¥æº

-   CSS Color Namesï¼ˆ140 ç§æ ‡å‡†è‰²ï¼‰ï¼›
-   xkcd color datasetï¼ˆ950+ ä¼—åŒ…å‘½åè‰²ï¼‰ã€‚

### 5.3 å®ç°é€»è¾‘

``` swift
struct NamedColor {
    let name: String
    let lab: (Double, Double, Double)
}

struct ColorNameResolver {
    let palette: [NamedColor]

    func nearestColorName(to color: (Double, Double, Double)) -> String {
        var minDeltaE = Double.greatestFiniteMagnitude
        var nearestName = ""
        for c in palette {
            let d = deltaE(color, c.lab)
            if d < minDeltaE {
                minDeltaE = d
                nearestName = c.name
            }
        }
        return nearestName
    }

    private func deltaE(_ c1: (Double, Double, Double), _ c2: (Double, Double, Double)) -> Double {
        let (L1, a1, b1) = c1
        let (L2, a2, b2) = c2
        return sqrt(pow(L1 - L2, 2) + pow(a1 - a2, 2) + pow(b1 - b2, 2))
    }
}
```

### 5.4 æµç¨‹æ•´åˆä½ç½®

1ï¸âƒ£ ä¸»è‰²æå–åï¼š

``` swift
let lab = rgbToLab(dominantColor.rgb)
let name = colorNameResolver.nearestColorName(to: lab)
```

2ï¸âƒ£ èšç±»è´¨å¿ƒå‘½åï¼š

``` swift
let name = colorNameResolver.nearestColorName(to: clusterCentroidLAB)
```

### 5.5 æ€§èƒ½ä¸ä¼˜åŒ–

-   åŒ¹é…900è‰²å®æ—¶æ— å‹åŠ›ï¼›
-   å¯æ‰©å±• KD-Treeï¼›
-   æ”¯æŒè¯­ä¹‰ä¿®é¥°ï¼ˆå¦‚ä½é¥±å’Œ â†’ "Muted"ã€é«˜äº®åº¦ â†’ "Pale"ï¼‰ã€‚

## 6. å…¨å±€èšç±»ä¸è‡ªé€‚åº”æ›´æ–°

-   ä½¿ç”¨ Silhouette / Davies--Bouldin è‡ªåŠ¨ç¡®å®š K âˆˆ \[3,12\]ã€‚
-   **ç®—æ³•**ï¼šKMeans æˆ– HDBSCANï¼›
-   **ç©ºé—´**ï¼šLABï¼›
-   **è¾“å‡º**ï¼šç°‡è´¨å¿ƒ Î¼â‚– ä¸æ ·æœ¬åˆ†å¸ƒã€‚

## 7. å›¾åƒå½’å±ä¸ä¸»è°ƒåˆ¤å®š

ä¸»è°ƒ = mix å‘é‡æœ€å¤§ç°‡ï¼› è‹¥ Î”Eâ‚€â‚€ â‰¤ 5 â†’ åŒ¹é…ï¼›5--10 â†’ åç§»ï¼›\>10 â†’
æ–°è‰²å€™é€‰ã€‚

## 8. è¾“å‡ºç»“æ„

  å­—æ®µ                 å†…å®¹
  -------------------- --------------
  image_id             å›¾ç‰‡æ ‡è¯†
  primary_color_name   ä¸»è‰²å‘½å
  primary_cluster      ä¸»ç°‡ç±»åˆ«
  mix_vector           å„ç°‡å æ¯”
  representative_lab   ä¸»è‰² LAB å€¼
  Î”E_to_cluster        è‰²å·®æŒ‡æ ‡
  confidence           ç°‡å½’å±ç½®ä¿¡åº¦

## 9. æ¨¡å—æ¶æ„

  æ¨¡å—å                  åŠŸèƒ½           çŠ¶æ€
  ----------------------- -------------- ------
  ColorAnalyzer           ä¸»è‰²æå–       âœ…
  ColorConverter          RGB â†” LAB      âœ…
  **ColorNameResolver**   **é¢œè‰²å‘½å**   ğŸ†•
  ClusteringManager       èšç±»ä¸æ›´æ–°     âœ…
  NeutralFilter           ä¸­æ€§è‰²ç­›é€‰     âœ…
  ResultFormatter         è¾“å‡ºç»“æœ       âœ…

## 10. æ€»ç»“

-   ä½¿ç”¨ **Median-Cut** æå–ä¸»è‰²ï¼›\
-   åœ¨ **LAB ç©ºé—´**èšç±»ï¼›\
-   ç”¨ **CSS/xkcd è‰²åº“** å‘½åï¼›\
-   å®ç°ä»åƒç´  â†’ æ„ŸçŸ¥ â†’ è¯­ä¹‰çš„é—­ç¯ï¼›\
-   æ”¯æŒè‡ªåŠ¨æ›´æ–°ã€å¯è§£é‡Šã€å¯æ‰©å±•çš„é¢œè‰²ä½“ç³»ã€‚
