# 增强：新增"多彩模式"预设

## 概述

为颜色丰富多样的照片集（如旅行照片、聚会照片、混合场景）添加专门的预设配置。

## 预设对比

### 1. 平衡分类（推荐，默认）

**适用场景**：日常使用，各种照片混合

**配置**：
- K 值：自动选择
- 自适应聚类：启用
- 合并阈值：12.0
- 名称相似性：启用
- 最小簇大小：2

**特点**：
- ✅ 平衡细分和简化
- ✅ 适合大多数场景
- ✅ 结果稳定可靠

### 2. 多彩模式（新增）

**适用场景**：颜色丰富多样的照片

**典型场景**：
- 🌍 旅行照片（风景、建筑、人物混合）
- 🎉 聚会照片（各种服装、装饰）
- 🎨 艺术照片（色彩丰富）
- 📸 混合场景（室内外、日夜混合）

**配置**：
```swift
manualKValue = nil               // 自动选择 K 值
enableAdaptiveClustering = true  // 启用自适应聚类
mergeThresholdDeltaE = 10.0      // 严格合并，保留更多色系
useColorNameSimilarity = false   // 不看名称，只看色差
minClusterSize = 1               // 保留所有簇，包括小簇
```

**特点**：
- ✅ **严格合并**：只合并非常相似的颜色，保留更多色系
- ✅ **保留小簇**：即使只有 1 张照片的色系也保留
- ✅ **自动 K 值**：根据照片数量和色彩多样性自动选择
- ✅ **纯色差判断**：不看名称，避免误合并不同颜色

**效果**：
- 得到更多色系（通常 5-10 个）
- 保留所有有意义的颜色
- 适合颜色丰富多样的照片集

### 3. 单色系细分

**适用场景**：颜色相近的照片

**典型场景**：
- 🌿 全绿色照片（森林、草地）
- 🌊 全蓝色照片（海洋、天空）
- 🍂 全棕色照片（秋天、沙漠）

**配置**：
```swift
manualKValue = 8                 // 强制 K=8
enableAdaptiveClustering = false // 关闭自适应聚类
mergeThresholdDeltaE = 6.0       // 非常严格
useColorNameSimilarity = false   // 不看名称
minClusterSize = 1               // 保留所有簇
```

**特点**：
- ✅ **强制高 K 值**：细分相似颜色
- ✅ **关闭自适应**：保留所有细微差异
- ✅ **严格合并**：只合并非常相似的颜色
- ✅ **保留小簇**：即使只有 1 张照片

### 4. 精细分类

**适用场景**：需要更多色系

**配置**：
- K 值：自动选择
- 合并阈值：8.0（严格）
- 名称相似性：关闭
- 最小簇大小：1

**特点**：
- ✅ 更多簇
- ✅ 保留细微差异
- ✅ 可能有很多小簇

### 5. 简洁分类

**适用场景**：需要更少色系

**配置**：
- K 值：自动选择
- 合并阈值：18.0（宽松）
- 名称相似性：启用
- 最小簇大小：3

**特点**：
- ✅ 更少簇
- ✅ 大幅简化
- ✅ 只保留主要色系

## 使用示例

### 示例 1：旅行照片（100 张）

**照片内容**：
- 蓝天（20张）
- 绿色植物（15张）
- 建筑（灰色、白色，25张）
- 人物（各种服装，30张）
- 夜景（深色，10张）

**使用"多彩模式"**：

**结果**：
1. sky blue（20张）- 天空
2. grass green（15张）- 植物
3. grey（25张）- 建筑
4. coral（12张）- 人物（暖色服装）
5. light blue（10张）- 人物（冷色服装）
6. navy（8张）- 人物（深色服装）
7. dark grey（10张）- 夜景

**优势**：
- ✅ 7 个主要色系，清晰明了
- ✅ 没有只有 1-2 张照片的"噪音"簇
- ✅ 相似的人物服装颜色被合理合并

### 示例 2：森林照片（6 张）

**照片内容**：
- 全是绿色，但有深浅和色调差异

**使用"单色系细分"**：

**结果**：
1. grass green（2张）- 草地
2. kelly green（1张）- 亮绿叶子
3. sage green（1张）- 灰绿叶子
4. mint green（1张）- 浅绿新叶
5. forest green（1张）- 深绿树干
6. 空簇
7. 空簇
8. 空簇

**优势**：
- ✅ 细分出 5 种不同的绿色
- ✅ 保留细微差异
- ✅ 适合单色系照片分析

### 示例 3：混合照片（50 张）

**照片内容**：
- 各种颜色混合，没有明显主题

**使用"平衡分类"（默认）**：

**结果**：
1. blue（15张）
2. green（12张）
3. grey（10张）
4. pink（8张）
5. brown（5张）

**优势**：
- ✅ 5 个主要色系，适中
- ✅ 每个簇至少 5 张照片
- ✅ 平衡细分和简化

## 技术细节

### 多彩模式的设计思路

1. **严格合并（ΔE = 10）**：
   - 只合并非常相似的颜色（如同一颜色的不同亮度）
   - 保留更多有意义的色系
   - 避免将不同颜色误合并

2. **保留所有簇（minClusterSize = 1）**：
   - 即使只有 1 张照片的色系也保留
   - 适合颜色丰富多样的照片集
   - 每个独特的颜色都有意义

3. **关闭名称相似性**：
   - 纯粹基于色差（ΔE）判断
   - 避免因名称相似而误合并不同颜色
   - 如"light blue"和"light green"不会因为都有"light"而合并

4. **自动 K 值**：
   - 根据照片数量和色彩多样性选择
   - 通常选择 K=5-10
   - 适合多样化场景

### 与其他预设的对比

| 特性 | 平衡 | 多彩 | 单色系 | 精细 | 简洁 |
|------|------|------|--------|------|------|
| **K 值** | 自动 | 自动 | 8（固定） | 自动 | 自动 |
| **自适应** | 启用 | 启用 | 关闭 | 启用 | 启用 |
| **合并阈值** | 12.0 | 10.0 | 6.0 | 8.0 | 18.0 |
| **名称相似性** | 启用 | 关闭 | 关闭 | 关闭 | 启用 |
| **最小簇** | 2 | 1 | 1 | 1 | 3 |
| **簇数量** | 中等 | 多 | 多 | 多 | 少 |
| **适用场景** | 通用 | 多彩 | 单色 | 细分 | 简化 |

## 预设选择指南

### 如何选择预设？

**问题 1：照片颜色是否相近？**
- ✅ 是（如全绿色、全蓝色）→ **单色系细分**
- ❌ 否 → 继续问题 2

**问题 2：照片颜色是否丰富多样？**
- ✅ 是（如旅行、聚会）→ **多彩模式**
- ❌ 否 → 继续问题 3

**问题 3：需要更多还是更少色系？**
- 更多 → **精细分类**
- 更少 → **简洁分类**
- 适中 → **平衡分类**（推荐）

### 快速参考

| 照片类型 | 推荐预设 |
|---------|---------|
| 🌍 旅行照片 | 多彩模式 |
| 🎉 聚会照片 | 多彩模式 |
| 🌿 森林/草地 | 单色系细分 |
| 🌊 海洋/天空 | 单色系细分 |
| 🍂 秋天/沙漠 | 单色系细分 |
| 📸 日常混合 | 平衡分类 |
| 🎨 艺术照片 | 多彩模式 或 精细分类 |
| 🏠 室内照片 | 平衡分类 或 简洁分类 |

## UI 位置

**设置界面 → 预设配置**：
1. 平衡分类（推荐）
2. **多彩模式（丰富色彩）** ← 新增
3. 单色系细分（同色系照片）
4. 精细分类（更多簇）
5. 简洁分类（更少簇）

**说明文字**：
> 快速应用预设配置，或在下方自定义。
> • 多彩模式：适合颜色丰富多样的照片（如旅行、聚会）
> • 单色系细分：适合颜色相近的照片（如全绿色、全蓝色）

## 后续优化

1. **智能预设推荐**：
   - 分析照片的色彩多样性
   - 自动推荐最合适的预设

2. **预设预览**：
   - 显示每个预设的典型结果
   - 帮助用户快速选择

3. **自定义预设**：
   - 允许用户保存自己的配置
   - 命名为"我的预设 1"、"我的预设 2"

---

**实施完成时间**：2025/11/9  
**实施者**：AI Assistant  
**文档版本**：1.0

